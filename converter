#!/usr/bin/env php
<?php

require __DIR__ . '/vendor/autoload.php';

use OfficeConverter\Command\CommandRegistry;

// конфиг проекта
const OUTPUT_DIR_PATH = __DIR__ . '/output/' ;
const STORAGE_DIR_PATH = __DIR__ . '/storage/';

if (count($argv) < 3) {
    die("Использование: php converter [command] [args...]\n\nПример: php converter convert offices.txt to:json\n");
}

$argv = $_SERVER['argv'];
array_shift($argv); // убрать имя скрипта

// convert, validate, stats и т.д.
$commandName = array_shift($argv);

try {
    $command = CommandRegistry::getCommand($commandName);
    $config  = CommandRegistry::createConfig($commandName, $argv);
    $result  = $command->execute($config);

    if ($result !== null) {
        echo $result;
    }
} catch (Exception $e) {
    echo "Ошибка: " . $e->getMessage() . PHP_EOL;
    exit(1);
}