#!/usr/bin/env php
<?php

require __DIR__ . '/vendor/autoload.php';

use OfficeConverter\Controller\OfficeConverter;
use OfficeConverter\Command\CommandFactory;

// конфиг проекта
const OUTPUT_DIR_PATH = __DIR__ . '/output/' ;
const STORAGE_DIR_PATH = __DIR__ . '/storage/';

if (count($argv) < 2) {
    die("Usage: php converter [command] [path-to-file] \n
        Example: php converter offices.txt to:json
    ");
}

if (!$argv[2]) {
    die("Path not found in the command\n");
}

$sourcePath = $argv[1];
$command    = $argv[2];

// run
try {
    $formatType = OfficeConverter::formatTypeFromString(str_replace('to:', '', $command));
    $commandInstance = CommandFactory::create($command);
    $resultPath = $commandInstance->execute($sourcePath, $formatType);
    echo "Conversion successful. Output file: $resultPath" . PHP_EOL;
} catch (Exception $e) {
    echo "Error: " . $e->getMessage() . PHP_EOL;
}